<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; connect-src 'self' ws://localhost:* http://localhost:* https://unpkg.com https://api.anthropic.com; img-src 'self' data: blob: https:; media-src 'self' blob:; font-src 'self' https://fonts.gstatic.com; frame-src http://localhost:* https://localhost:* http://127.0.0.1:* https://127.0.0.1:*;" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <title>BetterCode</title>
    <!-- Prevent theme flash: detect system/stored theme before render -->
    <script>
      (() => {
        var stored = localStorage.getItem('theme');
        var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = stored === 'light' ? 'light' : stored === 'dark' ? 'dark' : (prefersDark ? 'dark' : 'light');
        document.documentElement.classList.add(theme);
      })();
    </script>
    <style>
      /* Loading state before React loads - respects system theme */
      :root {
        --loading-bg: #ffffff;
        --loading-text: #09090b;
        --loading-logo: #a1a1aa;
      }
      .dark {
        --loading-bg: #09090b;
        --loading-text: #fafafa;
        --loading-logo: #71717a;
      }
      body {
        /* Keep in sync with --font-sans in globals.css and src/renderer/lib/fonts.ts */
        font-family: "Inter", system-ui, sans-serif;
        margin: 0;
        background: var(--loading-bg);
        color: var(--loading-text);
      }
      /* Loading container - hidden when React renders */
      .loading-container {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--loading-bg);
        z-index: 9999;
        transition: opacity 150ms ease-out;
      }
      /* Hide loading when root has content */
      #root:not(:empty) + .loading-container,
      #root:not(:empty) ~ .loading-container {
        opacity: 0;
        pointer-events: none;
      }
      .loading-logo {
        width: 24px;
        height: 24px;
        animation: pulse 1.5s ease-in-out infinite;
      }
      .loading-logo path {
        fill: var(--loading-logo);
        stroke: var(--loading-logo);
      }
      @keyframes pulse {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 0.6; }
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <!-- Loading indicator - separate from root so :empty works -->
    <div class="loading-container">
      <svg class="loading-logo" viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" d="M30 46L26 52L23 62L22 108L18 115L6 119L4 131L8 138L17 140L22 147L23 195L27 207L34 214L48 219L65 218L73 214L89 197L97 192L110 189L143 189L157 185L165 180L175 167L177 160L177 147L170 132L160 125L160 122L166 117L171 107L172 78L174 72L183 62L190 59L202 59L207 64L209 111L214 122L221 128L214 134L209 145L207 192L204 196L195 197L191 201L191 215L195 219L207 219L217 216L226 208L231 195L232 147L237 140L248 136L249 122L246 118L240 117L233 112L231 104L231 63L229 55L222 44L211 38L194 37L182 43L165 62L153 67L89 66L83 68L77 76L77 121L86 112L103 104L106 99L106 92L108 90L136 91L142 98L142 106L140 110L134 114L102 116L93 120L86 126L79 138L77 146L77 177L75 185L68 194L62 197L53 197L47 193L45 147L41 136L33 128L41 120L45 109L46 65L50 60L58 59L62 56L63 41L59 37L47 37L36 41Z M106 142L112 137L138 138L146 145L146 158L138 165L110 166L106 163Z"/>
      </svg>
    </div>
    <script>
      console.log("[HTML] Inline script running - scripts work!");
      window.onerror = (msg, url, line) => {
        console.error("[HTML] Global error:", msg, "at", url, "line", line);
        document.getElementById("root").innerHTML = `<pre style='color:red;padding:20px'>Error: ${msg}</pre>`;
      };
    </script>
    <script type="module" src="./main.tsx"></script>
  </body>
</html>
