@import "tailwindcss";
@import "tw-animate-css";
@import "./agents-styles.css";

@custom-variant dark (&:is(.dark *));
@config "../../../tailwind.config.js";

@layer base {
  :root {
    --background: 0 0% 100%;
    --foreground: 0 0% 9%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 9%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 9%;
    /* Monochrome primary - near black */
    --primary: 0 0% 9%;
    --primary-foreground: 0 0% 100%;
    --secondary: 0 0% 96%;
    --secondary-foreground: 0 0% 9%;
    --muted: 0 0% 96%;
    --muted-foreground: 0 0% 45%;
    --accent: 0 0% 96%;
    --accent-foreground: 0 0% 9%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 90%;
    --input: 0 0% 90%;
    --input-background: 0 0% 98%;
    /* Monochrome focus ring */
    --ring: 0 0% 9%;
    /* Monochrome text selection */
    --selection: 0 0% 9% / 0.12;
    --radius: 15px;
    /* Plan Mode - gray instead of orange */
    --plan-mode: 0 0% 45%;
    --plan-mode-foreground: 0 0% 100%;
    /* Timeline/Content background */
    --tl-background: 0 0% 98%;
    /* Chart colors */
    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    /* Sidebar colors */
    --sidebar: 0 0% 98%;
    --sidebar-foreground: 0 0% 9%;
    --sidebar-primary: 0 0% 9%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 0 0% 96%;
    --sidebar-accent-foreground: 0 0% 9%;
    --sidebar-border: 0 0% 90%;
    --sidebar-ring: 0 0% 9%;
  }

  .dark {
    --background: 0 0% 7%;
    --foreground: 0 0% 93%;
    --card: 0 0% 9%;
    --card-foreground: 0 0% 93%;
    --popover: 0 0% 11%;
    --popover-foreground: 0 0% 93%;
    /* Monochrome primary - light for dark mode */
    --primary: 0 0% 93%;
    --primary-foreground: 0 0% 7%;
    --secondary: 0 0% 15%;
    --secondary-foreground: 0 0% 93%;
    --muted: 0 0% 15%;
    --muted-foreground: 0 0% 55%;
    --accent: 0 0% 15%;
    --accent-foreground: 0 0% 93%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 18%;
    --input: 0 0% 18%;
    --input-background: 0 0% 11%;
    /* Monochrome focus ring */
    --ring: 0 0% 93%;
    /* Monochrome text selection */
    --selection: 0 0% 100% / 0.15;
    /* Plan Mode - gray instead of orange */
    --plan-mode: 0 0% 55%;
    --plan-mode-foreground: 0 0% 7%;
    /* Timeline/Content background */
    --tl-background: 0 0% 11%;
    /* Chart colors */
    --chart-1: 220 70% 50%;
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
    /* Sidebar colors */
    --sidebar: 0 0% 9%;
    --sidebar-foreground: 0 0% 93%;
    --sidebar-primary: 0 0% 93%;
    --sidebar-primary-foreground: 0 0% 7%;
    --sidebar-accent: 0 0% 15%;
    --sidebar-accent-foreground: 0 0% 93%;
    --sidebar-border: 0 0% 18%;
    --sidebar-ring: 0 0% 93%;
  }
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
    font-feature-settings:
      "rlig" 1,
      "calt" 1;
  }
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: hsl(var(--muted-foreground) / 0.3);
  border-radius: 2px;
}

::-webkit-scrollbar-thumb:hover {
  background: hsl(var(--muted-foreground) / 0.5);
}

/* Disable text selection on UI elements */
.no-select {
  user-select: none;
  -webkit-user-select: none;
}

/* Hide scrollbar but keep scroll functionality */
.scrollbar-hide {
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */
}

.scrollbar-hide::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Opera */
}

/* Drag region for window */
.drag-region {
  -webkit-app-region: drag;
}

.no-drag {
  -webkit-app-region: no-drag;
}

/* Chroma gradient animation for special keywords */
@keyframes chroma-slide {
  0% {
    background-position: 100% 0;
  }
  40% {
    background-position: 0% 0;
  }
  45% {
    background-position: 0% 0;
  }
  46% {
    background-position: 100% 0;
  }
  100% {
    background-position: 100% 0;
  }
}

.chroma-text {
  background-image: linear-gradient(
    90deg,
    #171717 0%,
    #171717 30%,
    #525252 42%,
    #737373 50%,
    #525252 58%,
    #171717 70%,
    #171717 100%
  );
  background-size: 300% 100%;
  background-position: 100% 0;
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  color: transparent;
}

.chroma-text-animate {
  animation: chroma-slide 2s ease-out infinite;
}

/* Dark theme chroma colors */
.dark .chroma-text {
  background-image: linear-gradient(
    90deg,
    #ededed 0%,
    #ededed 30%,
    #a3a3a3 42%,
    #d4d4d4 50%,
    #a3a3a3 58%,
    #ededed 70%,
    #ededed 100%
  );
}

/* Sonner Toast Styling - Google-style layout */
[data-sonner-toaster] {
  --normal-bg: hsl(var(--popover));
  --normal-text: hsl(var(--popover-foreground));
  --normal-border: hsl(var(--border));
  --border-radius: var(--radius);
  /* Override rich colors - all toasts should be neutral */
  --success-bg: hsl(var(--popover));
  --success-border: hsl(var(--border));
  --success-text: hsl(var(--popover-foreground));
  --info-bg: hsl(var(--popover));
  --info-border: hsl(var(--border));
  --info-text: hsl(var(--popover-foreground));
  --warning-bg: hsl(var(--popover));
  --warning-border: hsl(var(--border));
  --warning-text: hsl(var(--popover-foreground));
  --error-bg: hsl(var(--popover));
  --error-border: hsl(var(--border));
  --error-text: hsl(var(--popover-foreground));
}

[data-sonner-toast][data-styled="true"] {
  padding: 12px 16px;
  padding-right: 32px;
  gap: 8px;
  align-items: flex-start;
  flex-wrap: wrap;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Icon on the left */
[data-sonner-toast] [data-icon] {
  margin-top: 1px;
  color: hsl(var(--muted-foreground));
  width: 16px;
  height: 16px;
}

[data-sonner-toast] [data-icon] svg {
  width: 16px;
  height: 16px;
}

/* Loading spinner - match icon size */
[data-sonner-toast] .sonner-loading-wrapper {
  --size: 16px;
}

[data-sonner-toast] .sonner-loading-bar {
  background: hsl(var(--muted-foreground));
}

/* Content wrapper - take remaining space */
[data-sonner-toast] [data-content] {
  flex: 1;
  min-width: 0;
}

/* Title styling */
[data-sonner-toast] [data-title] {
  font-weight: 500;
  font-size: 14px;
  line-height: 1.4;
}

/* Description styling */
[data-sonner-toast] [data-description] {
  color: hsl(var(--muted-foreground));
  font-size: 13px;
  line-height: 1.4;
}

/* Action button - on its own row at the bottom right */
[data-sonner-toast][data-styled="true"] [data-button] {
  position: absolute;
  bottom: 12px;
  right: 8px;
  background: transparent;
  color: hsl(var(--foreground));
  font-weight: 500;
  font-size: 13px;
  padding: 4px 12px;
  height: auto;
  border: 1px solid hsl(var(--border));
  border-radius: 2px;
  margin: 0;
  transition: background-color 150ms ease-out, transform 150ms ease-out;
}

[data-sonner-toast][data-styled="true"] [data-button]:hover {
  background: hsl(var(--foreground) / 0.1);
}

[data-sonner-toast][data-styled="true"] [data-button]:active {
  transform: scale(0.97);
}

/* Add bottom padding when button exists */
[data-sonner-toast][data-styled="true"]:has([data-button]) {
  padding-bottom: 44px;
}

/* Close button - inside toast, top right corner */
[data-sonner-toast] [data-close-button] {
  position: absolute;
  top: 8px;
  right: 8px;
  left: unset;
  transform: none;
  background: transparent;
  border: none;
  border-radius: 2px;
  color: hsl(var(--muted-foreground));
  width: 20px;
  height: 20px;
}

[data-sonner-toast] [data-close-button]:hover {
  color: hsl(var(--foreground));
  background: hsl(var(--accent));
}

/* Terminal link popup */
.xterm-link-popup {
  font-family: "Geist Mono", ui-monospace, monospace;
  font-size: 12px;
  line-height: 1.4;
  padding: 4px 8px;
  border-radius: 2px;
  background: hsl(var(--popover));
  border: 1px solid hsl(var(--border));
  color: hsl(var(--popover-foreground));
  position: absolute;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  pointer-events: auto;
}

/* ========================================
   VIBRANCY/TRANSPARENCY STYLES
   For Liquid Glass themes with native macOS vibrancy
   ======================================== */

/*
 * When vibrancy is active, make ONLY the root elements transparent.
 * This allows the native macOS blur effect to show through.
 *
 * IMPORTANT: Do NOT make intermediate containers transparent!
 * The theme already has semi-transparent colors (with alpha) that
 * will provide the glass tint effect. Overriding them with
 * transparent would break the layering.
 */
html.vibrancy-active,
html.vibrancy-active body,
html.vibrancy-active #root,
html.vibrancy-active .loading-container {
  background: transparent;
  background-color: transparent;
}

/*
 * Make the outermost containers transparent to prevent stacking.
 * The app wrapper and its first-level children should be transparent.
 * Only the actual content containers should have the glass tint.
 */
html.vibrancy-active [data-agents-page] {
  background-color: transparent;
}

/* The main flex container inside [data-agents-page] */
html.vibrancy-active [data-agents-page] > div.flex {
  background: transparent;
}

/* The content flex container */
html.vibrancy-active [data-agents-page] > div > div.flex-1 {
  background: transparent;
}

/* Popovers and dialogs get subtle backdrop blur for better layering */
html.vibrancy-active [data-radix-portal] [role="dialog"],
html.vibrancy-active [data-radix-popper-content-wrapper] > * {
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
}

/* Make dialogs/modals more opaque for better readability */
/* Dark theme dialogs */
html.vibrancy-active.dark [data-radix-portal] [role="dialog"],
html.vibrancy-active.dark [data-canvas-dialog] {
  background-color: hsl(0 0% 10% / 0.92);
}

/* Light theme dialogs (Liquid Glass Light) */
html.vibrancy-active:not(.dark) [data-radix-portal] [role="dialog"],
html.vibrancy-active:not(.dark) [data-canvas-dialog] {
  background-color: hsl(0 0% 100% / 0.85);
}

/* Dark vibrancy popovers/dropdowns */
html.vibrancy-active.dark [data-radix-popper-content-wrapper] > * {
  background-color: hsl(0 0% 12% / 0.9);
}

/* Toast notifications */
html.vibrancy-active [data-sonner-toast] {
  backdrop-filter: saturate(180%) blur(20px);
  -webkit-backdrop-filter: saturate(180%) blur(20px);
}

/* Dark vibrancy toasts */
html.vibrancy-active.dark [data-sonner-toast] {
  background-color: hsl(0 0% 12% / 0.9);
}

/* ========================================
   VIBRANCY FALLBACK (Windows/Linux)
   CSS-only transparency when native vibrancy unavailable
   ======================================== */

/* Fallback: use CSS backdrop-filter where supported */
.vibrancy-fallback:not(.vibrancy-active) body {
  /* Slight transparency on body */
  background: hsl(var(--background) / 0.95);
}

/* Sidebar gets blur effect */
.vibrancy-fallback:not(.vibrancy-active) [data-sidebar] {
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  background: hsl(var(--card) / 0.85);
}

/* For browsers that don't support backdrop-filter */
@supports not (backdrop-filter: blur(10px)) {
  .vibrancy-fallback:not(.vibrancy-active) [data-sidebar] {
    background: hsl(var(--card) / 0.95);
  }
}

/* ========================================
   REDUCE TRANSPARENCY SUPPORT
   Per Apple accessibility guidelines - respect user preference
   ======================================== */

@media (prefers-reduced-transparency: reduce) {
  /* Remove transparency from root elements */
  html.vibrancy-active,
  html.vibrancy-active body,
  html.vibrancy-active #root {
    background: hsl(var(--background));
  }

  /* Make sidebar opaque */
  html.vibrancy-active [data-sidebar] {
    background: hsl(var(--card) / 0.95);
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
  }

  /* Make panels and containers more opaque */
  html.vibrancy-active [data-agents-page] {
    background: hsl(var(--background));
  }

  /* Disable backdrop blur on dialogs/popovers */
  html.vibrancy-active [data-radix-portal] [role="dialog"],
  html.vibrancy-active [data-radix-popper-content-wrapper] > * {
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    background: hsl(var(--popover));
  }
}

/* ========================================
   LIQUID GLASS LIGHT THEME ADJUSTMENTS
   Override dark mode variables for light vibrancy theme
   ======================================== */

/* Light vibrancy theme - override all dark variables */
html.vibrancy-active:not(.dark),
html.vibrancy-active:not(.dark) body {
  --background: 0 0% 100%;
  --foreground: 220 9% 46%;
  --card: 0 0% 100%;
  --card-foreground: 220 9% 46%;
  --popover: 0 0% 100%;
  --popover-foreground: 220 9% 46%;
  --primary: 220 9% 46%;
  --primary-foreground: 0 0% 100%;
  --secondary: 0 0% 96%;
  --secondary-foreground: 220 9% 46%;
  --muted: 0 0% 90%;
  --muted-foreground: 220 9% 55%;
  --accent: 0 0% 96%;
  --accent-foreground: 220 9% 46%;
  --border: 0 0% 0% / 0.06;
  --input: 0 0% 0% / 0.08;
  --input-background: 0 0% 100%;
  --ring: 220 9% 60%;
  --selection: 0 0% 0% / 0.07;
}

/* Light vibrancy agents page overrides */
html.vibrancy-active:not(.dark) [data-agents-page] {
  --muted: 0 0% 90%;
  --muted-foreground: 220 9% 55%;
}

/* Light vibrancy popovers/dropdowns */
html.vibrancy-active:not(.dark) [data-radix-popper-content-wrapper] > * {
  background-color: hsl(0 0% 100% / 0.9);
}

/* Light vibrancy toasts */
html.vibrancy-active:not(.dark) [data-sonner-toast] {
  background-color: hsl(0 0% 100% / 0.9);
}

@theme inline {
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --radius-2xl: calc(var(--radius) + 8px);
  --radius-3xl: calc(var(--radius) + 12px);
  --radius-4xl: calc(var(--radius) + 16px);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}
